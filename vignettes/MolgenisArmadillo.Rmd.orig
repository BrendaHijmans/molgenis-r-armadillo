---
title: "MolgenisArmadillo"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{MolgenisArmadillo}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(MolgenisArmadillo)
```

# Purpose
This library can be used by data managers to share datasets on a
MOLGENIS Armadillo server.
Researchers can then analyse these datasets and datasets shared on other servers
using DataSHIELD.

# Overview
The datasets are stored in shared folders on a MinIO file store. The MOLGENIS
Armadillo server has access to the file store and can load the data sets into
a shielded RServe environment so that researchers can call DataSHIELD analysis
methods on the data.

# Login
In order to access the files as a data manager, you need to log in.
The login method needs the URLs of the Armadillo server and the MinIO
server. It will open a browser window where you can identify yourself with
the ID provider.
```{r}
armadillo.login("https://armadillo.dev.molgenis.org",
      "https://armadillo-minio.dev.molgenis.org")
```

It will create a session and store the credentials in the environment:
```{r}
Sys.getenv("AWS_S3_ENDPOINT")
Sys.getenv("AWS_ACCESS_KEY_ID")
Sys.getenv("AWS_SECRET_ACCESS_KEY")
Sys.getenv("AWS_SESSION_TOKEN")
getOption("MolgenisArmadillo.s3.use_https")
getOption("cloudyr.aws.default_region")
```

Now you can create a shared folder and upload datasets to it
```{r}
library(datasets)
armadillo.create_folder("shared-folder")
armadillo.create_workspace("shared-folder", "test-data", iris, iris3)
armadillo.list_workspaces("shared-folder")
```